name: Publish to GH Packages

on:
  pull_request:
    branches:
      - master
      - develop

  workflow_dispatch:

jobs:
  build:
    runs-on: macOS-latest

    steps:
    - uses: actions/checkout@v1
    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Build library
      run: ./gradlew build publishToMavenLocal -x :web3:compileTestDevelopmentExecutableKotlinJs -x :web3:compileTestKotlinJs #syncMultiPlatformLibraryDebugFrameworkIosX64
    - name: Publish artifacts
      run: ./gradlew :web3:publishKotlinMultiplatformPublicationToGitHubPackagesRepository
      env:
        GITHUB_ACTOR: ${{ secrets.GITHUB_ACTOR }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#    - name: Install pods with kotlin
#      run: cd sample/ios-app && pod install
#    - name: build ios sample
#      run: cd sample/ios-app && set -o pipefail && xcodebuild -scheme ios-app -workspace ios-app.xcworkspace -configuration Debug -sdk iphonesimulator -arch x86_64 build CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO | xcpretty